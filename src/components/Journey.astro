---
---
<section class="journey-section" id="journey-trigger">
  <!-- Sticky container that holds the journey visualization -->
  <div class="journey-sticky">
    <div class="container container-wide">
      
      <!-- Progress Bar at top -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="journey-progress"></div>
        </div>
      </div>

      <div class="journey-flow">
        
        <!-- Connecting Line -->
        <div class="journey-line-container">
          <svg preserveAspectRatio="none" viewBox="0 0 1000 20" class="journey-line-svg">
            <line x1="50" y1="10" x2="950" y2="10" stroke="var(--bg-secondary)" stroke-width="2" />
            <line x1="50" y1="10" x2="950" y2="10" stroke="url(#progressGradient)" stroke-width="4" stroke-linecap="round" id="animated-line" />
            <defs>
              <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ef4444" /> <!-- Red/Chaos -->
                <stop offset="33%" stop-color="#8b5cf6" /> <!-- Purple/Process -->
                <stop offset="66%" stop-color="#3b82f6" /> <!-- Blue/Order -->
                <stop offset="100%" stop-color="#22c55e" /> <!-- Green/Insight -->
              </linearGradient>
            </defs>
          </svg>
        </div>

        <!-- Stages -->
        <div class="stages">
          
          <!-- Stage 1: Chaos -->
          <div class="stage" id="stage-1">
            <div class="icon-wrap color-chaos">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" class="draw-icon chaos-icon">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Scattered effect lines -->
                <line x1="2" y1="2" x2="6" y2="6" stroke="currentColor" stroke-width="1.5" stroke-dasharray="2 2" />
                <line x1="22" y1="22" x2="18" y2="18" stroke="currentColor" stroke-width="1.5" stroke-dasharray="2 2" />
              </svg>
            </div>
            <h3 class="stage-title">Chaos</h3>
            <p class="stage-desc muted">Emails, receipts, PDFs scattered.</p>
          </div>

          <!-- Stage 2: Process -->
          <div class="stage stage-hidden" id="stage-2">
            <div class="icon-wrap color-process">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" class="draw-icon process-icon">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- AI / Processing nodes -->
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <circle cx="19" cy="5" r="2" stroke="currentColor" stroke-width="2"/>
                <circle cx="5" cy="19" r="2" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <h3 class="stage-title">Process</h3>
            <p class="stage-desc muted">AI extracts & classifies data instantly.</p>
          </div>

          <!-- Stage 3: Order -->
          <div class="stage stage-hidden" id="stage-3">
            <div class="icon-wrap color-order">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" class="draw-icon order-icon">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="3" y1="9" x2="21" y2="9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="3" y1="15" x2="21" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="9" y1="3" x2="9" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="15" y1="3" x2="15" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h3 class="stage-title">Order</h3>
            <p class="stage-desc muted">Structured, named, and archived.</p>
          </div>

          <!-- Stage 4: Insight -->
          <div class="stage stage-hidden" id="stage-4">
            <div class="icon-wrap color-insight">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" class="draw-icon insight-icon">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 21h6M12 21v-3M12 18c3-2 5-5 5-8a5 5 0 1 0-10 0c0 3 2 6 5 8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="12" y1="2" x2="12" y2="5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="9" x2="2" y2="9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="22" y1="9" x2="19" y2="9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="7.05" y1="4.05" x2="4.93" y2="1.93" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="16.95" y1="4.05" x2="19.07" y2="1.93" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <h3 class="stage-title">Insight</h3>
            <p class="stage-desc muted">Ready for accounting and decisions.</p>
          </div>

        </div>
      </div>
      
    </div>
  </div>
</section>

<style>
  .journey-section {
    height: 300vh; /* Creates the scroll distance */
    position: relative;
    background-color: var(--bg-primary);
  }

  .journey-sticky {
    position: sticky;
    top: 0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .container-wide {
    max-width: 1400px;
    width: 100%;
    position: relative;
  }

  .progress-container {
    position: absolute;
    top: -80px;
    left: 20px;
    right: 20px;
  }

  .progress-bar {
    height: 2px;
    background: var(--bg-secondary);
    width: 100%;
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ef4444, #8b5cf6, #3b82f6, #22c55e);
    width: 0%; /* JS controlled */
    transform-origin: left;
  }

  .journey-flow {
    position: relative;
    width: 100%;
    padding: 60px 0;
  }

  .journey-line-container {
    position: absolute;
    top: 50%;
    left: 10%;
    right: 10%;
    transform: translateY(-50%);
    height: 20px;
    z-index: 0;
    pointer-events: none;
  }

  .journey-line-svg {
    width: 100%;
    height: 100%;
  }

  #animated-line {
    stroke-dasharray: 1000;
    stroke-dashoffset: 1000; /* Fully hidden, JS controlled */
  }

  .stages {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 10;
    width: 100%;
    padding: 0 5%;
  }

  .stage {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    width: 200px;
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .stage-hidden {
    opacity: 0.3;
    transform: translateY(10px);
  }

  .icon-wrap {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.05);
    margin-bottom: var(--space-md);
    transition: all 0.5s ease;
    box-shadow: 0 0 0 rgba(0,0,0,0);
  }

  .color-chaos { color: #ef4444; }
  .color-process { color: #8b5cf6; }
  .color-order { color: #3b82f6; }
  .color-insight { color: #22c55e; }

  /* Active states via JS */
  .stage.active .icon-wrap.color-chaos { box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); border-color: rgba(239, 68, 68, 0.5); }
  .stage.active .icon-wrap.color-process { box-shadow: 0 0 30px rgba(139, 92, 246, 0.3); border-color: rgba(139, 92, 246, 0.5); }
  .stage.active .icon-wrap.color-order { box-shadow: 0 0 30px rgba(59, 130, 246, 0.3); border-color: rgba(59, 130, 246, 0.5); }
  .stage.active .icon-wrap.color-insight { box-shadow: 0 0 30px rgba(34, 197, 94, 0.3); border-color: rgba(34, 197, 94, 0.5); }

  .stage-title {
    margin-bottom: var(--space-xs);
    font-size: 24px;
    color: var(--text-primary);
  }

  .stage-desc {
    font-size: 15px;
    line-height: 1.4;
  }

  /* Responsive Stacking */
  @media (max-width: 900px) {
    .stages {
      flex-direction: column;
      height: 70vh;
      justify-content: space-around;
    }
    .journey-line-container {
      top: 10%; bottom: 10%; left: 50%; right: auto;
      transform: translateX(-50%);
      width: 20px; height: 80%;
    }
    .journey-line-svg {
      transform: rotate(90deg);
      transform-origin: center;
    }
    .stage {
      flex-direction: row;
      width: 100%;
      max-width: 300px;
      text-align: left;
    }
    .icon-wrap {
      margin-bottom: 0;
      margin-right: var(--space-md);
      flex-shrink: 0;
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  // Ensure DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    gsap.registerPlugin(ScrollTrigger);

    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: "#journey-trigger",
        start: "top top",
        end: "bottom bottom",
        scrub: 1, // Smooth scrolling effect
      }
    });

    // We have 4 stages, so we divide the scroll into parts
    
    // Animate the connecting line
    tl.to("#animated-line", { strokeDashoffset: 0, ease: "none", duration: 1 }, 0);
    
    // Top Progress bar
    tl.to("#journey-progress", { width: "100%", ease: "none", duration: 1 }, 0);

    // Stage 1 is active from start
    document.getElementById('stage-1')?.classList.add('active');

    // Reveal stage 2 at 25%
    tl.to("#stage-2", { opacity: 1, y: 0, duration: 0.1, onStart: () => {
      document.getElementById('stage-2')?.classList.remove('stage-hidden');
      document.getElementById('stage-2')?.classList.add('active');
    }, onReverseComplete: () => {
      document.getElementById('stage-2')?.classList.add('stage-hidden');
      document.getElementById('stage-2')?.classList.remove('active');
    }}, 0.25);

    // Reveal stage 3 at 50%
    tl.to("#stage-3", { opacity: 1, y: 0, duration: 0.1, onStart: () => {
      document.getElementById('stage-3')?.classList.remove('stage-hidden');
      document.getElementById('stage-3')?.classList.add('active');
    }, onReverseComplete: () => {
      document.getElementById('stage-3')?.classList.add('stage-hidden');
      document.getElementById('stage-3')?.classList.remove('active');
    }}, 0.5);

    // Reveal stage 4 at 75%
    tl.to("#stage-4", { opacity: 1, y: 0, duration: 0.1, onStart: () => {
      document.getElementById('stage-4')?.classList.remove('stage-hidden');
      document.getElementById('stage-4')?.classList.add('active');
    }, onReverseComplete: () => {
      document.getElementById('stage-4')?.classList.add('stage-hidden');
      document.getElementById('stage-4')?.classList.remove('active');
    }}, 0.75);

  });
</script>
